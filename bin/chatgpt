#!/usr/bin/env rc
# Read one message per line formatted as "role	message" (tab separated)
# Collect all messages into a json list and ship it to chat completion

ifs=()
msgs=`{jq -nR '[inputs | split("\t") | {"role": .[0], "content": .[1]}]'}

curl https://api.openai.com/v1/chat/completions \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer '^$OPENAI_API_KEY \
  -d '{
    "model": "gpt-3.5-turbo",
    "messages": '^$msgs^'}' >[2]/dev/null
